<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galactic Defender</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        :root { --primary: #00ffff; --secondary: #ff0055; --gold: #ffd700; --power: #ff3300; }
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; font-family: 'Orbitron', sans-serif; touch-action: none; user-select: none; }
        canvas { display: block; width: 100%; height: 100%; }
        
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-top { display: flex; justify-content: space-between; padding: 15px; color: var(--primary); font-size: 14px; text-shadow: 0 2px 4px rgba(0,0,0,0.8); background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); }
        
        #bossHud { position: absolute; top: 70px; left: 10%; width: 80%; display: none; }
        .hp-bar-bg { width: 100%; height: 12px; background: #222; border: 2px solid #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px var(--secondary); }
        .hp-bar-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #ff0000, #ff8800); transition: width 0.2s; }
        
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(10,20,50,0.95) 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; z-index: 20; transition: opacity 0.3s; }
        .hidden { opacity: 0; pointer-events: none; z-index: -1; }
        
        h1 { font-size: 3rem; color: var(--primary); margin: 0; text-transform: uppercase; text-shadow: 0 0 20px var(--primary); text-align: center; }
        .btn { background: linear-gradient(45deg, #004466, #0088aa); border: 2px solid var(--primary); color: #fff; padding: 12px 30px; margin: 10px; font-size: 1.1rem; border-radius: 8px; width: 250px; text-align: center; text-transform: uppercase; box-shadow: 0 0 15px rgba(0, 255, 255, 0.2); }
        .btn-ad { background: linear-gradient(45deg, #b8860b, #ffd700); color: #000; font-weight: 900; border-color: #fff; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .ship-selector { display: flex; gap: 15px; margin-bottom: 20px; }
        .ship-card { border: 2px solid #444; width: 70px; height: 70px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); }
        .ship-card.selected { border-color: var(--secondary); box-shadow: 0 0 20px var(--secondary); transform: scale(1.1); }
        .ship-card img { width: 50px; height: 50px; object-fit: contain; }
        
        #bombBtn { position: absolute; bottom: 30px; right: 20px; width: 70px; height: 70px; border-radius: 50%; background: rgba(255, 0, 85, 0.9); border: 2px solid #fff; display: none; align-items: center; justify-content: center; font-size: 30px; pointer-events: auto; z-index: 15; }
        .float-text { position: absolute; color: gold; font-weight: bold; font-size: 14px; pointer-events: none; animation: floatUp 1s forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }
        
        /* Power Bars */
        .power-container { margin-top: 5px; font-size: 10px; color: var(--power); }
        .power-bar { display: inline-block; width: 10px; height: 10px; background: #333; margin-right: 2px; border: 1px solid #555; transform: skewX(-20deg); }
        .power-bar.active { background: var(--power); box-shadow: 0 0 5px var(--power); border-color: #fff; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="hud-top" id="hud" style="display: none;">
            <div>SCORE: <span id="scoreVal">0</span> <br><span style="color:var(--gold)">COINS: <span id="coinVal">0</span></span></div>
            <div style="text-align:center">
                MISSION <span id="levelVal">1</span>
                <div class="power-container" id="powerUi"><span class="power-bar active"></span><span class="power-bar"></span><span class="power-bar"></span><span class="power-bar"></span></div>
            </div>
            <div style="text-align:right"><div style="color:var(--secondary); font-size:20px;" id="hpVal">‚ù§‚ù§‚ù§</div><div style="font-size:12px; color:#aaa;">TARGET: <span id="taskVal">0</span></div></div>
        </div>
        <div id="bossHud"><div style="text-align:center; color:#fff; font-size:10px;">BOSS HP</div><div class="hp-bar-bg"><div class="hp-bar-fill" id="bossHpFill"></div></div></div>
        <div id="bombBtn">üí£</div>
    </div>

    <!-- MAIN MENU -->
    <div id="mainMenu" class="screen">
        <h1>GALACTIC<br>DEFENDER</h1>
        <div class="ship-selector" id="shipSelector"></div>
        <div class="btn" onclick="Game.start(1)">PLAY GAME</div>
        <div class="btn" onclick="UI.showShop()">ARMORY</div>
        <div class="btn" onclick="UI.showSettings()">SETTINGS</div>
    </div>

    <!-- SHOP -->
    <div id="shopScreen" class="screen hidden">
        <h2>ARMORY</h2>
        <h3 style="color:gold">Balance: $<span id="shopCoins">0</span></h3>
        <div class="grid-container" id="shopItems" style="text-align:center;"></div>
        <div class="btn" onclick="UI.goHome()">BACK</div>
    </div>

    <!-- SETTINGS -->
    <div id="settingScreen" class="screen hidden">
        <h2>SETTINGS</h2>
        <div class="btn" onclick="UI.goHome()">BACK</div>
    </div>

    <!-- END SCREEN -->
    <div id="endScreen" class="screen hidden">
        <h1 id="endTitle">GAME OVER</h1>
        <h2 id="endScore">Score: 0</h2>
        <div id="endButtons"></div>
    </div>

<script>
// ASSETS CONFIG
const ASSETS = {
    bg: 'bg.png',
    bullet: 'bullet.png',
    planes: ['plane1.png', 'plane2.png', 'plane3.png'],
    enemies: ['obscle1.png', 'obscle2.png'],
    bosses: ['boss1.png', 'boss2.png', 'boss3.png'],
    sounds: { bgm: 'bgm.wav', shoot: 'bullet.wav', explo: 'explosion.wav' }
};

const IMAGES = {};
const AUDIO = {};

function loadAssets() {
    // Images
    ['bg', 'bullet'].forEach(k => { let i=new Image(); i.src=ASSETS[k]; IMAGES[k]=i; });
    ASSETS.planes.forEach((s,i) => { let m=new Image(); m.src=s; IMAGES['plane'+i]=m; });
    ASSETS.enemies.forEach((s,i) => { let m=new Image(); m.src=s; IMAGES['enemy'+i]=m; });
    ASSETS.bosses.forEach((s,i) => { let m=new Image(); m.src=s; IMAGES['boss'+i]=m; });
    // Audio (Safe Load)
    AUDIO.bgm = new Audio(ASSETS.sounds.bgm); AUDIO.bgm.loop = true;
    AUDIO.shoot = new Audio(ASSETS.sounds.shoot);
    AUDIO.explo = new Audio(ASSETS.sounds.explo);
}

// STORAGE & CONFIG
const STORAGE_KEY = 'galactic_save_final';
const RESUME_KEY = 'galactic_resume_ad';
const Data = {
    coins: 0, maxLevel: 1, unlockedShips: [0], selectedShip: 0, dmgLvl: 1,
    load: function() { const s=localStorage.getItem(STORAGE_KEY); if(s) Object.assign(this, JSON.parse(s)); },
    save: function() { localStorage.setItem(STORAGE_KEY, JSON.stringify(this)); }
};

const cvs = document.getElementById('gameCanvas');
const ctx = cvs.getContext('2d');
let width, height;

// GAME VARS
let state='MENU', level=1, score=0, kills=0, targetKills=0, frame=0, shake=0, bomb=1;
let player, boss=null;
let bullets=[], enemies=[], particles=[], items=[], stars=[];
const input={x:0,y:0,active:false};

// ENTITIES
class Player {
    constructor(){this.x=width/2;this.y=height-120;this.w=60;this.h=60;this.hp=3;this.power=1;this.lastShot=0;this.shield=0;input.x=this.x;input.y=this.y;}
    update(){
        if(input.active){this.x+=(input.x-this.x)*0.15;this.y+=((input.y-60)-this.y)*0.15;}
        this.x=Math.max(30,Math.min(width-30,this.x)); this.y=Math.max(30,Math.min(height-30,this.y));
        if(state==='PLAY'){
            let r=this.power>=4?8:15; if(frame-this.lastShot>r){this.shoot();this.lastShot=frame;}
            if(this.shield>0)this.shield--;
        }
    }
    shoot(){
        if(state==='PLAY'){ let s=AUDIO.shoot.cloneNode(); s.volume=0.2; s.play().catch(()=>{}); }
        let dmg = Data.dmgLvl * (1+(this.power-1)*0.5);
        if(Data.selectedShip===0) bullets.push({x:this.x,y:this.y-30,vx:0,vy:-12,dmg:dmg,e:false});
        else {bullets.push({x:this.x-10,y:this.y-30,vx:0,vy:-12,dmg:dmg,e:false});bullets.push({x:this.x+10,y:this.y-30,vx:0,vy:-12,dmg:dmg,e:false});}
        if(this.power>=2){bullets.push({x:this.x-25,y:this.y,vx:-1,vy:-10,dmg:dmg,e:false});bullets.push({x:this.x+25,y:this.y,vx:1,vy:-10,dmg:dmg,e:false});}
        if(this.power>=3){bullets.push({x:this.x-35,y:this.y+10,vx:-3,vy:-9,dmg:dmg,e:false});bullets.push({x:this.x+35,y:this.y+10,vx:3,vy:-9,dmg:dmg,e:false});}
    }
    draw(){
        let img = IMAGES['plane'+Data.selectedShip];
        if(img && img.complete) { ctx.shadowBlur=15; ctx.shadowColor='#00ffff'; ctx.drawImage(img,this.x-30,this.y-30,60,60); ctx.shadowBlur=0; }
        else { ctx.fillStyle='#0ff'; ctx.fillRect(this.x-20,this.y-20,40,40); } // Fallback
        if(this.shield>0){ctx.strokeStyle=`rgba(0,255,255,${Math.random()})`;ctx.lineWidth=3;ctx.beginPath();ctx.arc(this.x,this.y,45,0,Math.PI*2);ctx.stroke();}
    }
    upgrade(){if(this.power<4){this.power++;spawnText(this.x,this.y-40,"POWER UP!","#ff3300");UI.bars();}else{score+=500;spawnText(this.x,this.y-40,"MAX POWER!","#ff3300");}}
}

class Enemy {
    constructor(t){this.x=Math.random()*(width-60)+30;this.y=-50;this.t=t;this.hp=Math.floor(2+(level*0.7));this.img='enemy'+(Math.random()>0.5?0:1);this.vy=(2+Math.random())*(1+level*0.05);this.vx=(t===1)?(Math.random()<0.5?-2:2):0;}
    update(){
        this.y+=this.vy; if(this.t===1){this.x+=this.vx;if(this.x<30||this.x>width-30)this.vx*=-1;}
        let prob=Math.min(0.03,0.005+level*0.001); if(Math.random()<prob)bullets.push({x:this.x,y:this.y+25,vx:0,vy:6+level*0.2,dmg:1,e:true});
        return this.y<height+60;
    }
    draw(){
        let i=IMAGES[this.img];
        if(i && i.complete) ctx.drawImage(i,this.x-25,this.y-25,50,50);
        else { ctx.fillStyle='red'; ctx.fillRect(this.x-20,this.y-20,40,40); }
    }
}

class Boss {
    constructor(l){this.x=width/2;this.y=-150;this.max=300+l*150;this.hp=this.max;this.dir=1;this.tm=0;let i=(l-1)%3;this.img='boss'+i;}
    update(){
        if(this.y<150)this.y++; else{this.x+=2*this.dir;if(this.x>width-80||this.x<80)this.dir*=-1;this.tm++;if(this.tm%50===0){let s=Math.min(3,1+Math.floor(level/5));for(let i=-s;i<=s;i++)bullets.push({x:this.x,y:this.y+60,vx:i*1.5,vy:6,dmg:1,e:true});}}
        document.getElementById('bossHpFill').style.width=(this.hp/this.max*100)+'%';
    }
    draw(){
        let i=IMAGES[this.img];
        if(i && i.complete) ctx.drawImage(i,this.x-75,this.y-60,150,120);
        else { ctx.fillStyle='purple'; ctx.fillRect(this.x-60,this.y-40,120,80); }
    }
}

// ENGINE
function init(){
    Data.load(); loadAssets(); resize(); window.addEventListener('resize',resize); setupInput();
    for(let i=0;i<60;i++)stars.push({x:Math.random()*width,y:Math.random()*height,s:Math.random()*2+0.5});
    UI.updateShipSelector();
    
    // Auto Resume Logic
    let rd = localStorage.getItem(RESUME_KEY);
    if(rd){
        rd=JSON.parse(rd);
        if(rd.act==='revive'){Game.start(rd.lvl);score=rd.sc;kills=rd.k;if(player)player.power=rd.pw;if(rd.bHp!==null){boss=new Boss(rd.lvl);boss.hp=rd.bHp;boss.max=rd.bMax;boss.y=150;document.getElementById('bossHud').style.display='block';}Game.revive();}
        else if(rd.act==='next'){Game.start(rd.lvl+1);score=rd.sc;if(player)player.power=rd.pw;}
        localStorage.removeItem(RESUME_KEY);
    }
    loop();
}
function resize(){width=cvs.width=window.innerWidth;height=cvs.height=window.innerHeight;}
function setupInput(){
    const s=(e)=>{e.preventDefault();input.active=true;let t=e.touches?e.touches[0]:e;input.x=t.clientX;input.y=t.clientY;};
    const m=(e)=>{if(input.active){let t=e.touches?e.touches[0]:e;input.x=t.clientX;input.y=t.clientY;}};
    cvs.addEventListener('touchstart',s,{passive:false});cvs.addEventListener('touchmove',m,{passive:false});
    cvs.addEventListener('mousedown',s);window.addEventListener('mousemove',m);window.addEventListener('mouseup',()=>input.active=false);
}
function spawnText(x,y,t,c){let d=document.createElement('div');d.className='float-text';d.style.left=x+'px';d.style.top=y+'px';d.style.color=c||'gold';d.innerText=t;document.body.appendChild(d);setTimeout(()=>d.remove(),800);}
function distSq(o1,o2){let dx=o1.x-o2.x,dy=o1.y-o2.y;return dx*dx+dy*dy;}

function loop(){
    requestAnimationFrame(loop);
    ctx.fillStyle='#000510';ctx.fillRect(0,0,width,height);
    if(IMAGES.bg&&IMAGES.bg.complete){ctx.globalAlpha=0.6;ctx.drawImage(IMAGES.bg,0,0,width,height);ctx.globalAlpha=1;}
    ctx.fillStyle='#fff';stars.forEach(s=>{s.y+=s.s;if(s.y>height)s.y=0;ctx.fillRect(s.x,s.y,s.s,s.s);});

    if(state!=='PLAY')return;
    frame++; if(shake>0){ctx.save();ctx.translate((Math.random()-0.5)*15,(Math.random()-0.5)*15);shake--;}
    player.update();player.draw();

    if(!boss){
        if(kills>=targetKills){boss=new Boss(level);enemies=[];document.getElementById('bossHud').style.display='block';if(navigator.vibrate)navigator.vibrate([100,50,100]);}
        else {
            let rate=Math.min(0.08,0.015+level*0.003);
            if(Math.random()<rate && enemies.length<12) enemies.push(new Enemy(level>3&&Math.random()>0.7?1:0));
        }
    } else {
        boss.update();boss.draw();if(distSq(boss,player)<4000)hitPlayer();
    }

    bullets=bullets.filter(b=>{
        b.x+=b.vx;b.y+=b.vy;
        if(b.e){ctx.fillStyle='red';ctx.beginPath();ctx.arc(b.x,b.y,6,0,Math.PI*2);ctx.fill();if(distSq(b,player)<900){hitPlayer();return false;}}
        else{
            if(IMAGES.bullet&&IMAGES.bullet.complete)ctx.drawImage(IMAGES.bullet,b.x-10,b.y-10,20,35);else{ctx.fillStyle='#0ff';ctx.fillRect(b.x-3,b.y-5,6,15);}
            let h=false;
            if(boss && Math.abs(b.x-boss.x)<70 && Math.abs(b.y-boss.y)<50){boss.hp-=b.dmg;h=true;if(boss.hp<=0)killBoss();}
            else if(!boss){
                for(let i=0;i<enemies.length;i++){if(distSq(b,enemies[i])<1600){enemies[i].hp-=b.dmg;h=true;if(enemies[i].hp<=0){killEnemy(enemies[i]);enemies.splice(i,1);}break;}}
            }
            if(h)return false;
        }
        return b.y>-50&&b.y<height+50;
    });

    enemies=enemies.filter(e=>{e.update();e.draw();if(distSq(e,player)<2500){hitPlayer();return false;}return e.y<height+60;});

    items=items.filter(i=>{
        i.y+=3;
        if(i.t===3){ctx.fillStyle='#ff3300';ctx.shadowBlur=15;ctx.shadowColor='red';ctx.beginPath();ctx.arc(i.x,i.y,12,0,Math.PI*2);ctx.fill();ctx.fillStyle='#fff';ctx.font='bold 16px Arial';ctx.fillText('‚ö°',i.x-6,i.y+6);ctx.shadowBlur=0;}
        else{ctx.fillStyle=i.t===0?'gold':(i.t===1?'lime':'cyan');ctx.beginPath();ctx.arc(i.x,i.y,10,0,Math.PI*2);ctx.fill();ctx.fillStyle='#000';ctx.font='bold 12px Arial';ctx.fillText(i.t===0?'$':(i.t===1?'+':'S'),i.x-4,i.y+4);}
        if(distSq(i,player)<1600){
            if(i.t===0){Data.coins++;spawnText(i.x,i.y,"+COIN");}
            if(i.t===1){player.hp=Math.min(3,player.hp+1);spawnText(i.x,i.y,"HP UP","lime");}
            if(i.t===2){player.shieldTimer=300;spawnText(i.x,i.y,"SHIELD","cyan");}
            if(i.t===3){player.upgrade();}
            UI.upd(); return false;
        }
        return i.y<height+50;
    });

    if(shake>0)ctx.restore();
}

function hitPlayer(){if(player.shieldTimer>0)return;player.hp--;shake=20;UI.upd();spawnText(player.x,player.y,"-1 HP","red");if(navigator.vibrate)navigator.vibrate(300);if(player.hp<=0){state='OVER';AUDIO.bgm.pause();UI.end(false);}}
function killEnemy(e){
    score+=10;kills++;UI.upd();spawnText(e.x,e.y,"+10");
    if(AUDIO.explo){let s=AUDIO.explo.cloneNode();s.volume=1.0;s.play().catch(()=>{});}
    // DYNAMIC DROP
    let dc=Math.min(0.6,0.2+(level*0.008));
    if(Math.random()<dc){
        let r=Math.random(); let t=0; let pc=Math.min(0.40,0.10+(level*0.006));
        if(r<pc)t=3; else if(r<pc+0.15)t=1; else if(r<pc+0.25)t=2;
        items.push({x:e.x,y:e.y,t:t});
    }
}
function killBoss(){shake=30;score+=1000*level;spawnText(boss.x,boss.y,"+1000","#00ffff");if(AUDIO.explo){AUDIO.explo.volume=1.0;AUDIO.explo.play().catch(()=>{});}if(level===Data.maxLevel){Data.maxLevel++;Data.save();}state='OVER';UI.end(true);}
document.getElementById('bombBtn').onclick=()=>{if(bomb>0&&state==='PLAY'){bomb--;document.getElementById('bombBtn').style.display='none';enemies=[];bullets=[];if(boss)boss.hp-=100;shake=40;ctx.fillStyle='white';ctx.fillRect(0,0,width,height);spawnText(width/2,height/2,"BOOM!","red");}};

// --- AD SYSTEM (AppCreator24 Reload Trick) ---
const Ads = {
    trig: (act) => {
        const d = {act:act, lvl:level, sc:score, k:kills, pw:player?player.powerLevel:1, bHp:boss?boss.hp:null, bMax:boss?boss.maxHp:null};
        localStorage.setItem(RESUME_KEY, JSON.stringify(d));
        location.reload(); // Triggers Interstitial
    }
};

const UI={
    upd:()=>{document.getElementById('scoreVal').innerText=score;document.getElementById('coinVal').innerText=Data.coins;document.getElementById('hpVal').innerText="‚ù§".repeat(Math.max(0,player.hp));document.getElementById('taskVal').innerText=`${kills}/${targetKills}`;},
    bars:()=>{if(!player)return;const b=document.querySelectorAll('.power-bar');b.forEach((e,i)=>{if(i<player.powerLevel)e.classList.add('active');else e.classList.remove('active');});},
    end:(v)=>{
        document.getElementById('endScreen').classList.remove('hidden');document.getElementById('hud').style.display='none';document.getElementById('bombBtn').style.display='none';document.getElementById('bossHud').style.display='none';document.getElementById('endScore').innerText="Score: "+score;
        const t=document.getElementById('endTitle');const c=document.getElementById('endButtons');c.innerHTML='';
        if(v){t.innerText="MISSION COMPLETE";t.style.color="#00ff00";c.innerHTML+=`<div class="btn btn-ad" onclick="Ads.trig('next')">NEXT LEVEL (AD) ‚ñ∂</div>`;}
        else{t.innerText="GAME OVER";t.style.color="#ff0000";c.innerHTML+=`<div class="btn btn-ad" onclick="Ads.trig('revive')">REVIVE (AD) ‚Ü∫</div>`;}
        if(!v)c.innerHTML+=`<div class="btn" onclick="Game.restartLevel()">RETRY</div>`;c.innerHTML+=`<div class="btn" onclick="UI.showLevelSelect()">LEVELS</div>`;c.innerHTML+=`<div class="btn" onclick="UI.goHome()">MENU</div>`;
    },
    goHome:()=>{state='MENU';AUDIO.bgm.pause();document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));document.getElementById('mainMenu').classList.remove('hidden');document.getElementById('ui-layer').style.display='none';UI.updateShipSelector();},
    showLevelSelect:()=>{document.getElementById('mainMenu').classList.add('hidden');document.getElementById('endScreen').classList.add('hidden');document.getElementById('levelScreen').classList.remove('hidden');const g=document.getElementById('levelGrid');g.innerHTML='';for(let i=1;i<=50;i++){let d=document.createElement('div');d.className=`level-box ${i>Data.maxLevel?'locked':''}`;d.innerText=i;d.onclick=()=>{if(i<=Data.maxLevel)Game.start(i);};g.appendChild(d);}},
    showShop:()=>{document.getElementById('mainMenu').classList.add('hidden');document.getElementById('shopScreen').classList.remove('hidden');document.getElementById('shopCoins').innerText=Data.coins;const g=document.getElementById('shopItems');g.innerHTML=`<div class="level-box" onclick="Game.buyDmg()">WEAPON DMG+<br><small>Lvl ${Data.dmgLvl}</small><br><span style="color:gold">$${500*Data.dmgLvl}</span></div>`;['plane1.png','plane2.png','plane3.png'].forEach((s,i)=>{if(!Data.unlockedShips.includes(i))g.innerHTML+=`<div class="level-box" onclick="Game.buyShip(${i})"><img src="${s}" width="30"><br>SHIP ${i+1}<br><span style="color:gold">$${1000*(i+1)}</span></div>`;});},
    showSettings:()=>{document.getElementById('mainMenu').classList.add('hidden');document.getElementById('settingScreen').classList.remove('hidden');},
    updateShipSelector:()=>{const d=document.getElementById('shipSelector');d.innerHTML='';ASSETS.planes.forEach((s,i)=>{if(Data.unlockedShips.includes(i)){let v=document.createElement('div');v.className=`ship-card ${Data.selectedShip===i?'selected':''}`;v.innerHTML=`<img src="${s}">`;v.onclick=()=>{Data.selectedShip=i;Data.save();UI.updateShipSelector();};d.appendChild(v);}});}
};

const Game={
    start:(l)=>{level=l;score=0;kills=0;if(l<=5)targetKills=10+(l*2);else targetKills=20+(l*4);bomb=1;boss=null;bullets=[];enemies=[];items=[];particles=[];player=new Player();state='PLAY';document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden'));document.getElementById('ui-layer').style.display='block';document.getElementById('hud').style.display='flex';document.getElementById('bombBtn').style.display='flex';document.getElementById('levelVal').innerText=level;UI.updatePowerBars();if(Data.settings.music){AUDIO.bgm.currentTime=0;AUDIO.bgm.play().catch(()=>{});}UI.updateScore();},
    restartLevel:()=>Game.start(level),
    revive:(ins)=>{if(!player)player=new Player();player.hp=3;player.shieldTimer=300;if(!boss)enemies=[];bullets=[];state='PLAY';if(Data.settings.music)AUDIO.bgm.play().catch(()=>{});document.getElementById('endScreen').classList.add('hidden');document.getElementById('hud').style.display='flex';document.getElementById('bombBtn').style.display='flex';if(boss)document.getElementById('bossHud').style.display='block';input.active=false;UI.updateScore();UI.updatePowerBars();},
    buyDmg:()=>{if(Data.coins>=500*Data.dmgLvl){Data.coins-=500*Data.dmgLvl;Data.dmgLvl++;Data.save();UI.showShop();}},
    buyShip:(i)=>{if(Data.coins>=1000*(id+1)){Data.coins-=1000*(id+1);Data.unlockedShips.push(i);Data.save();UI.showShop();}}
};
init();
</script>
</body>
</html>